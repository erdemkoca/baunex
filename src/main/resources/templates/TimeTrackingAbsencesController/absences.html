{#include layout}
  {#title}Urlaub & Abwesenheiten â€“ Baunex{/title}
  {#header}Urlaub & Abwesenheiten{/header}
  {#content}
    <style>
      .yearly-calendar {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 10px;
        margin: 20px 0;
      }
      
      .month-calendar {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 10px;
        background: white;
      }
      
      .month-header {
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: #495057;
      }
      
      .month-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        font-size: 10px;
      }
      
      .day-cell {
        padding: 2px;
        text-align: center;
        border-radius: 2px;
        min-height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      
      .day-cell.weekend {
        background-color: #f8f9fa;
        color: #6c757d;
      }
      
      .day-cell.public-holiday {
        background-color: #cff4fc;
        color: #0dcaf0;
        font-weight: bold;
      }
      
      .day-cell.employee-holiday {
        background-color: #d1e7dd;
        color: #198754;
        font-weight: bold;
      }
      
      .day-cell.pending-holiday {
        background-color: #fff3cd;
        color: #856404;
        font-weight: bold;
      }
      
      .day-cell.rejected-holiday {
        background-color: #f8d7da;
        color: #721c24;
        font-weight: bold;
      }
      
      .day-cell.multiple-employees {
        background: linear-gradient(45deg, #d1e7dd 25%, #fff3cd 25%, #fff3cd 50%, #d1e7dd 50%, #d1e7dd 75%, #fff3cd 75%);
        background-size: 6px 6px;
        color: #333;
        font-weight: bold;
      }
      
      .employee-stats-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
        transition: all 0.2s;
      }
      
      .employee-stats-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }
      
      .stat-item {
        text-align: center;
        padding: 8px;
        border-radius: 4px;
        background: #f8f9fa;
      }
      
      .stat-value {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }
      
      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 2px;
      }
      
      .holiday-request-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
      }
      
      .holiday-request-card.pending {
        border-left: 4px solid #ffc107;
      }
      
      .holiday-request-card.approved {
        border-left: 4px solid #198754;
      }
      
      .holiday-request-card.rejected {
        border-left: 4px solid #dc3545;
      }
      
      .approval-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }
      
      .calendar-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
      }
      
      .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 12px;
      }
      
      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 2px;
      }
      
      /* Weekly Calendar Styles */
      .weekly-calendar-container {
        margin-top: 20px;
        max-height: 600px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        position: relative;
      }
      
      .calendar-header {
        position: sticky;
        top: 0;
        background: white;
        z-index: 100;
        border-bottom: 2px solid #dee2e6;
        padding: 10px 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .calendar-header-grid {
        display: grid;
        grid-template-columns: 60px 20px repeat(7, 1fr);
        gap: 2px;
        font-size: 12px;
      }
      
      .week-row {
        border-bottom: 1px solid #dee2e6;
        padding: 4px 15px;
        background: white;
        position: relative;
        margin-left: 90px;
      }
      
      .week-row:last-child {
        border-bottom: none;
      }
      
      .week-header h6 {
        color: #495057;
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 14px;
      }
      
      .week-grid {
        display: grid;
        grid-template-columns: 60px 20px repeat(7, 1fr);
        gap: 2px;
        font-size: 11px;
      }

      /* Month indicator */
      .month-indicator {
        position: absolute;
        left: -90px;
        top: 50%;
        transform: translateY(-50%);
        background: #f8f9fa;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
        color: #495057;
        border: 1px solid #dee2e6;
        white-space: nowrap;
        z-index: 5;
        min-width: 60px;
        text-align: center;
      }

      .month-indicator.january { background-color: #e3f2fd; }
      .month-indicator.february { background-color: #f3e5f5; }
      .month-indicator.march { background-color: #e8f5e8; }
      .month-indicator.april { background-color: #fff3e0; }
      .month-indicator.may { background-color: #fce4ec; }
      .month-indicator.june { background-color: #e0f2f1; }
      .month-indicator.july { background-color: #f1f8e9; }
      .month-indicator.august { background-color: #fff8e1; }
      .month-indicator.september { background-color: #f3e5f5; }
      .month-indicator.october { background-color: #ffebee; }
      .month-indicator.november { background-color: #e8eaf6; }
      .month-indicator.december { background-color: #e0f2f1; }

      .day-header {
        background-color: #f8f9fa;
        padding: 4px 4px;
        text-align: center;
        font-weight: bold;
        color: #495057;
        border-radius: 4px;
        font-size: 11px;
      }
      
      .week-number {
        background-color: transparent;
        padding: 4px 4px;
        text-align: left;
        font-weight: bold;
        color: #6c757d;
        border-radius: 4px;
        font-size: 11px;
      }

      .week-number-header {
        background-color: transparent;
        padding: 4px 4px;
        text-align: left;
        font-weight: bold;
        color: #6c757d;
        border-radius: 4px;
        font-size: 11px;
      }
      
      .day-cell {
        min-height: 35px;
        padding: 2px;
        border: 1px solid transparent;
        border-radius: 4px;
        background: white;
        position: relative;
      }
      
      .day-cell.weekend {
        background-color: #f8f9fa;
      }
      
      .day-cell.public-holiday {
        background-color: #6c757d;
        color: white;
      }
      
      .calendar-day-number {
        font-size: 11px;
        font-weight: bold;
        text-align: left;
        margin-bottom: 2px;
        color: #333;
        padding-left: 2px;
        position: absolute;
        top: 2px;
        left: 2px;
      }
      
      .public-holiday-indicator {
        font-size: 8px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 2px;
        color: white;
        background-color: #6c757d;
        padding: 1px 3px;
        border-radius: 2px;
        position: absolute;
        bottom: 2px;
        right: 2px;
        max-width: 60%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 20px;
        height: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .holiday-bar {
        font-size: 8px;
        padding: 1px 3px;
        margin: 1px 0;
        border-radius: 2px;
        color: white;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
      }
      
      .holiday-bar:hover {
        opacity: 0.8;
      }

      /* Multi-day holiday bars */
      .holiday-bar-multi {
        position: absolute;
        height: 20px;
        border-radius: 3px;
        color: white;
        font-size: 9px;
        font-weight: bold;
        display: flex;
        align-items: center;
        padding: 0 6px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        z-index: 5;
      }
      
      .holiday-bar-multi:hover {
        opacity: 0.8;
      }
      
      .section-header {
        margin-top: 40px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #dee2e6;
        color: #495057;
      }
      
      .overview-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .overview-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .overview-card h3 {
        margin-bottom: 10px;
        font-size: 24px;
        font-weight: bold;
      }
      
      .overview-card p {
        color: #666;
        margin: 0;
      }
    </style>
    
    <div id="absences-app"
         data-holidays='{holidaysJson}'
         data-employees='{employeesJson}'
         data-pending-holidays='{pendingHolidaysJson}'
         data-approved-holidays='{approvedHolidaysJson}'
         data-rejected-holidays='{rejectedHolidaysJson}'
         data-employee-stats='{employeeStatsJson}'
         data-public-holidays='{publicHolidaysJson}'
         data-current-year='{currentYear}'>

      <!-- Overview Section -->
      <div class="container-fluid">
        <h2 class="section-header">Ãœbersicht {currentYear}</h2>
        
        <!-- Overview Statistics -->
        <div class="overview-stats">
          <div class="overview-card">
            <h3 class="text-warning">{{ pendingRequests }}</h3>
            <p>Ausstehende Anfragen</p>
          </div>
          <div class="overview-card">
            <h3 class="text-success">{{ approvedHolidays ? approvedHolidays.length : 0 }}</h3>
            <p>Genehmigte Urlaube</p>
          </div>
          <div class="overview-card">
            <h3 class="text-danger">{{ rejectedHolidays ? rejectedHolidays.length : 0 }}</h3>
            <p>Abgelehnte Anfragen</p>
          </div>
          <div class="overview-card">
            <h3 class="text-info">{{ publicHolidays ? publicHolidays.length : 0 }}</h3>
            <p>Feiertage {currentYear}</p>
          </div>
        </div>
        
        <!-- Employee Statistics -->
        <div class="row">
          <div class="col-12">
            <h5>Mitarbeiter Ãœbersicht</h5>
            <div class="row" v-if="employeeStats">
              <div class="col-md-6 col-lg-4" v-for="employee in employeeStats" :key="employee.employeeId">
                <div class="employee-stats-card">
                  <h6>{{ employee.employeeName }}</h6>
                  <div class="stats-grid">
                    <div class="stat-item">
                      <div class="stat-value">{{ employee.totalVacationDays }}</div>
                      <div class="stat-label">Urlaubstage</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value">{{ employee.usedVacationDays }}</div>
                      <div class="stat-label">Genommen</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value">{{ employee.remainingVacationDays }}</div>
                      <div class="stat-label">Verbleibend</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value">{{ employee.pendingRequests }}</div>
                      <div class="stat-label">Ausstehend</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar Section -->
      <div class="container-fluid">
        <h2 class="section-header">Kalender {currentYear}</h2>
        
        <!-- Calendar Legend -->
        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-color" style="background-color: #6c757d;"></div>
            <span>Feiertage</span>
          </div>
        </div>

        <!-- Weekly Calendar -->
        <div class="weekly-calendar-container" v-if="weeklyCalendarData">
          <div class="calendar-header">
            <div class="calendar-header-grid">
              <div class="week-number-header">KW</div>
              <div></div>
              <div class="day-header">MO</div>
              <div class="day-header">DI</div>
              <div class="day-header">MI</div>
              <div class="day-header">DO</div>
              <div class="day-header">FR</div>
              <div class="day-header">SA</div>
              <div class="day-header">SO</div>
            </div>
          </div>

          <div class="week-row" v-for="(week, weekIndex) in weeklyCalendarData" :key="week.weekNumber">
            <!-- Month indicator -->
            <div v-if="shouldShowMonthIndicator(week, weekIndex)"
                 class="month-indicator"
                 :class="getMonthClass(getMonthForWeek(week))">
              {{ getMonthForWeek(week) }}
            </div>

            <div class="week-grid">
              <div class="week-number">{{ week.weekNumber }}</div>
              <div></div>
              <div class="day-cell"
                   v-for="day in week.days"
                   :key="day.date"
                   :class="{
                     'weekend': day.isWeekend,
                     'public-holiday': day.publicHoliday
                   }">

                <!-- Calendar Day Number (Left-aligned) -->
                <div class="calendar-day-number">{{ day.dayNumber }}</div>

                <!-- Public Holiday Indicator -->
                <div v-if="day.publicHoliday" class="public-holiday-indicator">
                  {{ day.publicHoliday }}
                </div>

                <!-- Employee Holiday Bars -->
                <div v-for="holiday in day.employeeHolidays"
                     :key="holiday.employeeId"
                     class="holiday-bar"
                     :style="getHolidayBarStyle(holiday)"
                     :title="holiday.employeeName + ' - ' + holiday.reason">
                  {{ holiday.employeeName }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Requests Section -->
      <div class="container-fluid">
        <h2 class="section-header">Urlaubsanfragen</h2>
        
        <!-- Pending Requests -->
        <div class="row" v-if="pendingHolidays && pendingHolidays.length > 0">
          <div class="col-12">
            <h5>Ausstehende Anfragen</h5>
            <div class="holiday-request-card pending" v-for="request in pendingHolidays" :key="request.id">
              <div class="row">
                <div class="col-md-8">
                  <h6>{{ request.employeeName }}</h6>
                  <p><strong>Zeitraum:</strong> {{ request.startDate }} - {{ request.endDate }}</p>
                  <p><strong>Grund:</strong> {{ request.reason }}</p>
                  <p><strong>Angefordert am:</strong> {{ request.requestDate }}</p>
                </div>
                <div class="col-md-4">
                  <div class="approval-buttons">
                    <button class="btn btn-success btn-sm" @click="approveRequest(request.id)">
                      Genehmigen
                    </button>
                    <button class="btn btn-danger btn-sm" @click="rejectRequest(request.id)">
                      Ablehnen
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Approved Requests -->
        <div class="row mt-4" v-if="approvedHolidays && approvedHolidays.length > 0">
          <div class="col-12">
            <h5>Genehmigte Urlaube</h5>
            <div class="holiday-request-card approved" v-for="request in approvedHolidays" :key="request.id">
              <div class="row">
                <div class="col-md-8">
                  <h6>{{ request.employeeName }}</h6>
                  <p><strong>Zeitraum:</strong> {{ request.startDate }} - {{ request.endDate }}</p>
                  <p><strong>Grund:</strong> {{ request.reason }}</p>
                  <p><strong>Genehmigt am:</strong> {{ request.approvalDate }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Rejected Requests -->
        <div class="row mt-4" v-if="rejectedHolidays && rejectedHolidays.length > 0">
          <div class="col-12">
            <h5>Abgelehnte Anfragen</h5>
            <div class="holiday-request-card rejected" v-for="request in rejectedHolidays" :key="request.id">
              <div class="row">
                <div class="col-md-8">
                  <h6>{{ request.employeeName }}</h6>
                  <p><strong>Zeitraum:</strong> {{ request.startDate }} - {{ request.endDate }}</p>
                  <p><strong>Grund:</strong> {{ request.reason }}</p>
                  <p><strong>Abgelehnt am:</strong> {{ request.rejectionDate }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Section -->
      <div class="container-fluid">
        <h2 class="section-header">Statistiken {currentYear}</h2>
        
        <!-- Overall Statistics -->
        <div class="row">
          <div class="col-md-3">
            <div class="stat-item">
              <div class="stat-value">{{ totalEmployees }}</div>
              <div class="stat-label">Mitarbeiter</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-item">
              <div class="stat-value">{{ totalVacationDays }}</div>
              <div class="stat-label">Gesamt Urlaubstage</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-item">
              <div class="stat-value">{{ usedVacationDays }}</div>
              <div class="stat-label">Genommen</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-item">
              <div class="stat-value">{{ pendingRequests }}</div>
              <div class="stat-label">Ausstehende Anfragen</div>
            </div>
          </div>
        </div>

        <!-- Monthly Breakdown -->
        <div class="row mt-4">
          <div class="col-12">
            <h5>Monatliche Ãœbersicht</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Monat</th>
                    <th>Genehmigte Urlaube</th>
                    <th>Ausstehende Anfragen</th>
                    <th>Feiertage</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="month in monthlyStats" :key="month.month">
                    <td>{{ month.monthName }}</td>
                    <td>{{ month.approvedHolidays }}</td>
                    <td>{{ month.pendingRequests }}</td>
                    <td>{{ month.publicHolidays }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/js/time-tracking-absences.js"></script>
  {/content}
{/include} 
{#include layout}
    {#title}Neuer Rechnungsentwurf{/title}
    {#header}Neuer Rechnungsentwurf{/header}
    {#content}
        <div class="container-fluid">
            <form action="/invoice-drafts/new" method="post">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">Projekt ausw채hlen</h5>
                        
                        <!-- Projektauswahl -->
                        <div class="mb-4">
                            <label for="projectId" class="form-label">Projekt</label>
                            <select class="form-select"
                                    id="projectId"
                                    name="projectId"
                                    required>
                                <option value="">-- Bitte w채hlen --</option>
                                {#each projects}
                                    <option value="{it.id}" {#if selectedProject && selectedProject.id == it.id}selected{/if}>
                                        {it.name} - {it.customerName}
                                    </option>
                                {/each}
                            </select>
                        </div>

                        {#if selectedProject}
                            <!-- Projektdetails -->
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">Projektdetails</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Kunde:</strong> {selectedProject.customerName}</p>
                                            <p><strong>Adresse:</strong> {selectedProject.customer.street}, {selectedProject.customer.city}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Projektname:</strong> {selectedProject.name}</p>
                                            <p><strong>Beschreibung:</strong> {selectedProject.description}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Zeitraum -->
                            <div class="row mb-4">
                                <div class="col-6">
                                    <label for="serviceStartDate" class="form-label">Service von</label>
                                    <input type="date"
                                           class="form-control"
                                           id="serviceStartDate"
                                           name="serviceStartDate"
                                           value="{currentDate}">
                                </div>
                                <div class="col-6">
                                    <label for="serviceEndDate" class="form-label">Service bis</label>
                                    <input type="date"
                                           class="form-control"
                                           id="serviceEndDate"
                                           name="serviceEndDate"
                                           value="{currentDate}">
                                </div>
                            </div>

                            <!-- Zeiteintr채ge -->
                            {#if selectedProject.timeEntries.size > 0}
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Zeiteintr채ge</h5>
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Datum</th>
                                                        <th>Mitarbeiter</th>
                                                        <th>Beschreibung</th>
                                                        <th>Stunden</th>
                                                        <th>Stundensatz</th>
                                                        <th>Gesamt</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {#each selectedProject.timeEntries}
                                                        <tr>
                                                            <td>{it.date.format('dd.MM.yyyy')}</td>
                                                            <td>{it.employeeEmail}</td>
                                                            <td>{it.notes}</td>
                                                            <td>{it.hoursWorked}</td>
                                                            <td>{it.hourlyRate}</td>
                                                            <td>{it.cost}</td>
                                                        </tr>
                                                    {/each}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            {/if}

                            <!-- Katalog-Items -->
                            {#if selectedProject.catalogItems.size > 0}
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Katalog-Items</h5>
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Artikel</th>
                                                        <th>Menge</th>
                                                        <th>Einzelpreis</th>
                                                        <th>Gesamt</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {#each selectedProject.catalogItems}
                                                        <tr>
                                                            <td>{it.itemName}</td>
                                                            <td>{it.quantity}</td>
                                                            <td>{it.unitPrice}</td>
                                                            <td>{it.totalPrice}</td>
                                                        </tr>
                                                    {/each}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            {/if}

                            <!-- Notizen -->
                            <div class="mb-4">
                                <label for="notes" class="form-label">Notizen</label>
                                <textarea class="form-control"
                                          id="notes"
                                          name="notes"
                                          rows="3"></textarea>
                            </div>

                            <!-- Aktionen -->
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-plus"></i> Rechnungsentwurf erstellen
                                </button>
                                <a href="/invoice-drafts" class="btn btn-outline-secondary">
                                    <i class="bi bi-x"></i> Abbrechen
                                </a>
                            </div>
                        {/if}
                    </div>
                </div>
            </form>
        </div>
    {/content}
{/include} 